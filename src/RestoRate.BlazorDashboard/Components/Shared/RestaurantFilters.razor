@using RestoRate.SharedKernel.Enums
@using MudBlazor
@using RestoRate.Contracts.Restaurant.DTOs

<MudPaper Class="rr-cloud pa-6 mb-6" Elevation="2">
    <MudGrid Spacing="3">

        <MudItem xs="12" lg="5">
            <MudAutocomplete T="string"
                             Label="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..."
                             @bind-Value="searchTerm"
                             SearchFunc="@SearchRestaurants"
                             ResetValueOnEmptyText="true"
                             Clearable="true"
                             Variant="Variant.Filled"
                             AdornmentIcon="@Icons.Material.Filled.Search"
                             DebounceInterval="300"
                             MaxItems="10"
                             Class="filter-input" />
        </MudItem>

        <MudItem xs="12" lg="3">
            <MudSelect T="string"
                       Label="–ö—É—Ö–Ω—è"
                       @bind-Value="selectedCuisineName"
                       Variant="Variant.Filled"
                       Clearable="true"
                       AnchorOrigin="Origin.BottomCenter">
                <MudSelectItem T="string" Value="@(null)">–í—Å–µ –∫—É—Ö–Ω–∏</MudSelectItem>
                @foreach (var cuisine in CuisineType.List.OrderBy(c => c.Name))
                {
                    <MudSelectItem T="string" Value="@cuisine.Name">@cuisine.Name</MudSelectItem>
                }
            </MudSelect>
        </MudItem>

        <MudItem xs="12" lg="3">
            <MudSelect T="string"
                       Label="–¢—ç–≥–∏"
                       @bind-Value="selectedTag"
                       Variant="Variant.Filled"
                       Clearable="true"
                       AnchorOrigin="Origin.BottomCenter">
                <MudSelectItem T="string" Value="@(null)">–í—Å–µ —Ç—ç–≥–∏</MudSelectItem>
                <MudSelectItem T="string" Value="@("–ñ–∏–≤–∞—è –º—É–∑—ã–∫–∞")">üé∏ –ñ–∏–≤–∞—è –º—É–∑—ã–∫–∞</MudSelectItem>
                <MudSelectItem T="string" Value="@("–£—é—Ç–Ω–æ–µ –º–µ—Å—Ç–æ")">üè† –£—é—Ç–Ω–æ–µ –º–µ—Å—Ç–æ</MudSelectItem>
                <MudSelectItem T="string" Value="@("–ë–∏–∑–Ω–µ—Å-–ª–∞–Ω—á")">üíº –ë–∏–∑–Ω–µ—Å-–ª–∞–Ω—á</MudSelectItem>
                <MudSelectItem T="string" Value="@("–î–ª—è –¥–µ—Ç–µ–π")">üë∂ –î–ª—è –¥–µ—Ç–µ–π</MudSelectItem>
            </MudSelect>
        </MudItem>

        <MudItem xs="12" lg="1" Class="d-flex align-center justify-end">
            <MudButton Variant="Variant.Text" Color="Color.Default"
                       StartIcon="@Icons.Material.Filled.RestartAlt"
                       Size="Size.Small" OnClick="ResetFilters">
                –°–±—Ä–æ—Å
            </MudButton>
        </MudItem>
    </MudGrid>
</MudPaper>

@code {
    [Parameter] public EventCallback OnFiltersChanged { get; set; }

    private string? searchTerm;
    private string? selectedCuisineName;
    private string? selectedTag;

    private Task<IEnumerable<string>> SearchRestaurants(string value, CancellationToken token)
    {
        if (string.IsNullOrWhiteSpace(value))
            return Task.FromResult<IEnumerable<string>>(Array.Empty<string>());

        return Task.FromResult<IEnumerable<string>>(new[] { value });
    }

    private async Task ResetFilters()
    {
        searchTerm = null;
        selectedCuisineName = null;
        selectedTag = null;
        await OnFiltersChanged.InvokeAsync();
    }

    public (string? SearchTerm, string? CuisineType, string? Tag) GetFilters()
    {
        return (searchTerm, selectedCuisineName, selectedTag);
    }
}
