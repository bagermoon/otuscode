@using RestoRate.Contracts.Restaurant.DTOs
@using MudBlazor
@using RestoRate.SharedKernel.Enums

<MudCard Class="rr-cloud rr-hover" Style="cursor:pointer; overflow:hidden;" @onclick="() => OnOpen.InvokeAsync(Restaurant)">

    <MudCardMedia Image="@GetPrimaryImage()" Height="140" />

    <MudCardContent Class="pa-3">

        <div class="d-flex justify-space-between align-start mb-1">
            <MudText Typo="Typo.subtitle1" Class="font-weight-bold lh-sm">@Restaurant.Name</MudText>

            <MudChip T="string" Size="Size.Small" Color="@GetStatusColor()" Variant="Variant.Filled" Class="mr-0" Style="height:20px; font-size:10px;">
                @Restaurant.RestaurantStatus
            </MudChip>
        </div>

        @if (!string.IsNullOrWhiteSpace(Restaurant.Description))
        {
            <MudText Typo="Typo.caption" Class="line-clamp-2 mb-2 text-secondary">
                @Restaurant.Description
            </MudText>
        }

        <div class="mt-2">
            @if (Restaurant.CuisineTypes?.Any() == true)
            {
                <MudChipSet T="string" Class="d-flex flex-wrap gap-1">
                    @foreach (var cuisine in Restaurant.CuisineTypes.Take(2))
                    {
                        var name = CuisineType.TryFromName(cuisine, out var cType) ? cType.Name : cuisine;
                        <MudChip T="string" Size="Size.Small" Variant="Variant.Filled" Color="Color.Primary" Class="ma-0 px-2" Style="height:22px;">
                            @name
                        </MudChip>
                    }
                </MudChipSet>
            }

            @if (Restaurant.Tags?.Any() == true)
            {
                <div class="d-flex flex-wrap gap-1 mt-1">
                    @foreach (var tag in Restaurant.Tags.Take(2))
                    {
                        <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined" Class="ma-0 px-2" Style="height:22px;">
                            #@tag
                        </MudChip>
                    }
                </div>
            }
        </div>
    </MudCardContent>

    @if (!string.IsNullOrWhiteSpace(Restaurant.Address?.FullAddress))
    {
        <MudDivider />
        <div class="px-3 py-1 d-flex align-center">
            <MudIcon Icon="@Icons.Material.Filled.Place" Size="Size.Small" Color="Color.Secondary" Class="mr-1" Style="font-size:14px;" />
            <MudText Typo="Typo.caption" Color="Color.Secondary" Class="text-truncate" Style="font-size:11px;">
                @Restaurant.Address.FullAddress
            </MudText>
        </div>
    }
</MudCard>

@code {
    [Parameter] public RestaurantDto Restaurant { get; set; } = default!;
    [Parameter] public EventCallback<RestaurantDto> OnOpen { get; set; }

    private string GetPrimaryImage()
    {
        var primary = Restaurant.Images?.FirstOrDefault(i => i.IsPrimary);
        return primary?.Url ?? "https://via.placeholder.com/400x140?text=RestoRate";
    }

    private Color GetStatusColor() => Restaurant.RestaurantStatus switch
    {
        "Published" => Color.Success,
        "Draft" => Color.Warning,
        "Archived" => Color.Default,
        _ => Color.Default
    };
}
