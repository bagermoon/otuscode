@inherits LayoutComponentBase
@using MudBlazor
@using Microsoft.AspNetCore.Components.Authorization
@using RestoRate.Abstractions.Identity
@using RestoRate.BlazorDashboard.Themes

@inject IUserContext UserContext

<MudThemeProvider Theme="@AppTheme.Default" IsDarkMode="false" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Fixed="true" Elevation="0" Color="Color.Transparent" Class="rr-appbar pa-4">
        <MudContainer MaxWidth="MaxWidth.ExtraLarge">
            <MudPaper Class="rr-cloud d-flex align-center px-6 py-3 gap-4" Elevation="4">

                <div class="d-flex gap-2">
                    <MudButton Variant="Variant.Text" Color="Color.Primary" Href="/" Match="NavLinkMatch.All" Class="font-weight-bold">
                        Главная
                    </MudButton>

                    <MudButton Variant="Variant.Text" Color="Color.Primary" Href="catalog" Class="font-weight-bold">
                        Каталог
                    </MudButton>
                </div>

                <MudSpacer />

                <AuthorizeView>
                    <Authorized>
                        <div class="d-flex align-center gap-4">

                            <a href="user-claims" class="d-flex align-center gap-3 text-decoration-none hover-scale">
                                <div class="d-flex flex-column align-end">
                                    <MudText Typo="Typo.subtitle2" Color="Color.Primary" Class="font-weight-bold" Style="line-height: 1.2;">
                                        @UserContext.FullName
                                    </MudText>
                                    <MudText Typo="Typo.caption" Class="font-weight-bold mud-text-secondary" Style="font-size: 0.7rem;">
                                        Пользователь
                                    </MudText>
                                </div>
                                <MudAvatar Color="Color.Primary" Variant="Variant.Filled" Size="Size.Medium">
                                    @(UserContext.FullName?.FirstOrDefault().ToString().ToUpper() ?? "U")
                                </MudAvatar>
                            </a>

                            <MudDivider Vertical="true" FlexItem="true" Class="my-2" />

                            <form action="authentication/logout" method="post" class="d-flex">
                                <AntiforgeryToken />
                                <input type="hidden" name="ReturnUrl" value="/" />
                                <MudTooltip Text="Выйти">
                                    <MudIconButton ButtonType="ButtonType.Submit"
                                                   Icon="@Icons.Material.Filled.Logout"
                                                   Color="Color.Error"
                                                   Size="Size.Small"
                                                   Variant="Variant.Filled"
                                                   Class="rounded-circle" />
                                </MudTooltip>
                            </form>
                        </div>
                    </Authorized>
                    <NotAuthorized>
                        <MudButton Variant="Variant.Filled"
                                   Color="Color.Secondary"
                                   Href="authentication/login"
                                   Class="rounded-pill px-6">
                            Войти
                        </MudButton>
                    </NotAuthorized>
                </AuthorizeView>
            </MudPaper>
        </MudContainer>
    </MudAppBar>

    <MudMainContent Class="rr-main">
        <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-8">
            @Body
        </MudContainer>
    </MudMainContent>
</MudLayout>
